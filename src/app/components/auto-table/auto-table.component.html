<div class="p-card p-3">
  @if (tableData && tableData.length > 0) {
    <p-table
      #dt
      [value]="tableData"
      [resizableColumns]="true"
      [columns]="tableColumns"
      [dataKey]="'id'"
      [rowHover]="true"
      [rows]="10"
      [showCurrentPageReport]="true"
      [rowsPerPageOptions]="[10, 25, 50]"
      [loading]="loading"
      [paginator]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
      [tableStyle]="{'min-width': '50rem'}">
      <ng-template pTemplate="caption">
        <div class="flex justify-between">
          <p-button [outlined]="true" icon="pi pi-filter-slash" label="Clear" (onClick)="dt.clear()" />
          <div class="flex gap-4">
            <p-button [outlined]="true" icon="pi pi-file-excel" label="Export" (onClick)="dt.exportCSV()" />
            <p-button [outlined]="true" icon="pi pi-plus" label="Add" (onClick)="addRow()" />
          </div>
        </div>
      </ng-template>
      <ng-template pTemplate="header" let-columns>
        <tr>
          @for (column of tableColumns; track column) {
            @switch (column.formatType.type) {
              @case ("currency") {
                <th [pSortableColumn]="column.field" style="min-width: 14rem">
                  <div class="flex justify-between items-center">
                    <span>{{ column.header }}</span>
                    <p-sortIcon [field]="column.field" />
                    <p-columnFilter [type]="column.type" [field]="column.field" [showClearButton]="false" display="menu" class="ml-auto" />
                  </div>
                </th>
              }
              @default {
                <th [pSortableColumn]="column.field" style="min-width: 14rem">
                  <div class="flex justify-between items-center">
                    <span>{{ column.header }}</span>
                    <p-sortIcon [field]="column.field" />
                    <p-columnFilter [type]="column.type" [field]="column.field" [showClearButton]="false" display="menu" class="ml-auto" />
                  </div>
                </th>
              }
            }
          }
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-data let-columns="columns">
        <tr>
          @for (column of tableColumns; track column) {
            @switch (column.formatType.type) {
              @case ("date") {
                <td>{{ data[column.field] | date: 'medium' }}</td>
              }
              @case ("enum") {
                <td>
                  <p-tag [value]="data[column.field]" [severity]="getSeverity(data[column.field], column.formatType.enum!)" />
                </td>
              }
              @case ("currency") {
                <td>{{ data[column.field] | currency: 'EUR' }}</td>
              }
              @default {
                <td>{{ data[column.field] }}</td>
              }
            }
          }
        </tr>
      </ng-template>
    </p-table>
  }
</div>
<p-dialog [header]="'Add '" [modal]="true" [(visible)]="showModal" [style]="{ width: '25rem' }">
  <auto-form [autoTableHeaders]="tableColumns"></auto-form>
  <div class="py-5 flex justify-end gap-2">
    <p-button label="Cancel" severity="secondary" (onClick)="showModal = false"/>
    <p-button label="Save" (onClick)="showModal = false"/>
  </div>
</p-dialog>
